---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ImageCard from "../../components/ImageCard.astro";
import { getAllObjects, getImagesForObject, getObjectAssetUrl, getObjectBySlug } from "../../lib/content";

export async function getStaticPaths() {
  const objects = await getAllObjects();
  return objects.map((object) => ({
    params: { slug: object.slug }
  }));
}

const { slug } = Astro.params;
if (!slug) {
  throw new Error("Missing object slug");
}

const object = await getObjectBySlug(slug);
if (!object) {
  return Astro.redirect("/objects");
}

const images = await getImagesForObject(object.id);
---

<BaseLayout
  title={`${object.title} | Objects | AstroCaptures`}
  description={object.description}
  canonicalPath={`/objects/${object.slug}`}
>
  <section class="hero object-hero">
    <img
      class="object-avatar"
      src={getObjectAssetUrl(object.id)}
      alt=""
      width="72"
      height="72"
      loading="lazy"
      decoding="async"
      onerror="this.style.display='none'"
    />
    <div class="object-hero-copy">
      <h1>{object.title}</h1>
      <p class="muted">{object.object_type}</p>
      <p>{object.description}</p>
    </div>
  </section>

  <section>
    <h2 class="section-title">Images</h2>
    {
      images.length === 0 ? (
        <p class="muted">No images linked yet.</p>
      ) : (
        <div class="grid">
          {images.map((image) => <ImageCard image={image} />)}
        </div>
      )
    }
  </section>
</BaseLayout>
